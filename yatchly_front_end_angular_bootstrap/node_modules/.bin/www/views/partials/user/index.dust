{>"layouts/header"/}
<div ng-controller="UserController" data-ng-init="OnLoad()">	
	<table class="table" ng-view>
	  <thead>
		<tr>
		  <th scope="col">#</th>
		  <th scope="col">Name</th>
		  <th scope="col">Email</th>
		  <th scope="col">Phone Number</th>
		  <th scope="col">Address</th>
		  <th scope="col">Action</th>
		</tr>
	  </thead>
	  <tbody>
		<tr ng-repeat="r in rows">
		  <td>{{ $index+1 }}</td>
		  <td>{{ r.name }}</td>
		  <td>{{ r.email }}</td>
		  <td>{{ r.phoneNumber }}</td>
		  <td>{{ r.address }}</td>
		  <td> 
				<a target="_blank" href="/user/edit/{{ r.userID }}" class="btn btn-primary a-btn-slide-text">
					<span class="icon-edit" aria-hidden="true"></span>           
				</a>
				
				<a target="#" href="#" refID="{{ r.userID }}" ng-confirm-click="Are you sure to delete this record ?" confirmed-click="DeleteData({{ r.userID }})" class="btn btn-danger a-btn-slide-text">
					<span class="icon-trash" aria-hidden="true" refID="{{ r.userID }}"></span>           
				</a>
		</tr>
	  </tbody>
	</table>
</div>

<script>
	var app = angular.module('myApp', []);
	app.directive('ngConfirmClick', [
		function(){
			return {
				link: function (scope, element, attr) {
					var msg = attr.ngConfirmClick || "Are you sure?";
					var clickAction = attr.confirmedClick;
					element.bind('click',function (event) {
						if ( window.confirm(msg) ) {
							scope.$eval(clickAction)
						}
					});
				}
			};
	}])

	app.controller('UserController', function($scope, $http) {
		$scope.OnLoad = function() {
			$http({
				method : "GET",
				url: 'http://127.0.0.1:3000/api/user',
			  }).then(function mySuccess(response) {
				  $scope.rows = response.data.data;
				  //console.log($scope.rows); 
				}, function myError(response) {
				  console.log(response.statusText);
			 });
		}
		
		$scope.DeleteData = function DeleteData($userID){
			var userID = $userID;
			$http({
				method : "POST",
				url: 'http://127.0.0.1:3000/api/user/delete',
				data: {userID: userID}
			  }).then(function mySuccess(response) {
				   var message = 'Data successfully deleted';
				   console.log(response);				   
				   
				   if (response.data.status != 'success') message = response.data.messages.join("<br>");
				   else 
				   {
						$scope.rows.forEach(function(e, index){
							if (e.userID == userID) { 
								$scope.rows.splice(index, 1);
								console.log(index);
							}
						});
				   }
				   $("#myModal .modal-body").html(message);
				   $("#myModal").modal();
				}, function myError(response) {
				  console.log(response.statusText);
			 });
		}
	});
</script>
{>"layouts/footer"/}